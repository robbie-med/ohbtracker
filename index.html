<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>OB Tracker</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Top Bar -->
<header id="topbar">
  <h1>OB Tracker</h1>
  <div class="topbar-actions">
    <button id="btn-theme" title="Toggle theme">ğŸŒ™</button>
    <button id="btn-data" title="Export / Import">ğŸ“‹</button>
    <button id="btn-add" title="Add patient">ï¼‹</button>
  </div>
</header>

<!-- Alert Banner -->
<div id="alert-banner" class="alert-banner hidden"></div>

<!-- Room Grid -->
<main id="room-grid" class="room-grid"></main>

<!-- Empty State -->
<div id="empty-state" class="empty-state">
  <p>No patients yet</p>
  <p class="subtle">Tap ï¼‹ to add a patient</p>
</div>

<!-- Add Patient Modal -->
<div id="modal-add" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Patient</h2>
      <button class="modal-close" data-close="modal-add">âœ•</button>
    </div>
    <form id="form-add">
      <div class="form-row">
        <label>Room #</label>
        <input type="text" id="add-room" required maxlength="10" inputmode="numeric" autocomplete="off">
      </div>
      <div class="form-row">
        <label>Name</label>
        <input type="text" id="add-name" required maxlength="40" autocomplete="off">
      </div>
      <div class="form-row">
        <label>Type</label>
        <div class="toggle-group">
          <button type="button" class="toggle-btn active" data-type="mother">ğŸ¤° Mother</button>
          <button type="button" class="toggle-btn" data-type="baby">ğŸ‘¶ Baby</button>
        </div>
      </div>
      <!-- Mother: DOB is date only, Admitted is datetime -->
      <div class="form-row" id="add-dob-row">
        <label>Date of Birth</label>
        <input type="date" id="add-dob">
      </div>
      <div class="form-row" id="add-admitted-row">
        <label>Admitted</label>
        <input type="datetime-local" id="add-admitted">
      </div>
      <!-- Baby: DOB is datetime (born time), no admit field -->
      <div class="form-row" id="add-born-row" style="display:none">
        <label>Born (Date/Time)</label>
        <input type="datetime-local" id="add-born">
      </div>
      <div class="form-row">
        <label>Status</label>
        <div class="toggle-group">
          <button type="button" class="toggle-btn status-btn active" data-status="green">ğŸŸ¢</button>
          <button type="button" class="toggle-btn status-btn" data-status="yellow">ğŸŸ¡</button>
          <button type="button" class="toggle-btn status-btn" data-status="red">ğŸ”´</button>
        </div>
      </div>
      <fieldset id="mother-fields">
        <legend>Mother Options</legend>
        <div class="form-row">
          <label>G / P</label>
          <div style="display:flex;gap:0.4rem;">
            <input type="text" id="add-gravida" placeholder="G" maxlength="5" style="width:50%;" autocomplete="off">
            <input type="text" id="add-para" placeholder="P" maxlength="10" style="width:50%;" autocomplete="off">
          </div>
        </div>
        <div class="form-row">
          <label>GA (weeks)</label>
          <input type="text" id="add-ga" placeholder="e.g. 38+2" maxlength="10" autocomplete="off">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-preeclamptic"> Preeclamptic (2hr mag checks)</label>
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-labor"> In Labor (4hr progress notes)</label>
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-csection"> C-Section</label>
        </div>
        <div class="form-row" id="csection-date-row" style="display:none">
          <label>C-Section Date</label>
          <input type="date" id="add-csection-date">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-delivered"> Delivered</label>
        </div>
        <div class="form-row" id="delivery-date-row" style="display:none">
          <label>Delivery Date/Time</label>
          <input type="datetime-local" id="add-delivery-time">
        </div>
        <div class="form-row">
          <label>EBL (mL)</label>
          <input type="number" id="add-ebl" min="0" inputmode="numeric">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-gbs"> GBS +</label>
        </div>
      </fieldset>
      <fieldset id="baby-fields" style="display:none">
        <legend>Baby Options</legend>
        <div class="form-row">
          <label>Birth Weight (g)</label>
          <input type="number" id="add-weight" min="0" inputmode="numeric">
        </div>
        <div class="form-row">
          <label>Feeding</label>
          <select id="add-feeding">
            <option value="">â€”</option>
            <option value="breast">Breast</option>
            <option value="bottle">Bottle</option>
            <option value="combo">Combo</option>
          </select>
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-nicu"> In NICU</label>
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="add-bili-lights"> On Bili Lights</label>
        </div>
        <div class="form-row">
          <label>Bili Level</label>
          <input type="number" id="add-bili" min="0" step="0.1" inputmode="decimal">
        </div>
      </fieldset>
      <button type="submit" class="btn-primary">Add Patient</button>
    </form>
  </div>
</div>

<!-- Patient Detail Modal -->
<div id="modal-detail" class="modal hidden">
  <div class="modal-content modal-detail-content">
    <div class="modal-header">
      <h2 id="detail-title">Room</h2>
      <button class="modal-close" data-close="modal-detail">âœ•</button>
    </div>
    <div id="detail-body"></div>
  </div>
</div>

<!-- Edit Patient Modal -->
<div id="modal-edit" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Edit Patient</h2>
      <button class="modal-close" data-close="modal-edit">âœ•</button>
    </div>
    <form id="form-edit">
      <input type="hidden" id="edit-id">
      <div class="form-row">
        <label>Room #</label>
        <input type="text" id="edit-room" required maxlength="10" inputmode="numeric" autocomplete="off">
      </div>
      <div class="form-row">
        <label>Name</label>
        <input type="text" id="edit-name" required maxlength="40" autocomplete="off">
      </div>
      <div class="form-row">
        <label>Type</label>
        <div class="toggle-group" id="edit-type-group">
          <button type="button" class="toggle-btn active" data-type="mother">ğŸ¤° Mother</button>
          <button type="button" class="toggle-btn" data-type="baby">ğŸ‘¶ Baby</button>
        </div>
      </div>
      <div class="form-row" id="edit-dob-row">
        <label>Date of Birth</label>
        <input type="date" id="edit-dob">
      </div>
      <div class="form-row" id="edit-admitted-row">
        <label>Admitted</label>
        <input type="datetime-local" id="edit-admitted">
      </div>
      <div class="form-row" id="edit-born-row" style="display:none">
        <label>Born (Date/Time)</label>
        <input type="datetime-local" id="edit-born">
      </div>
      <div class="form-row">
        <label>Status</label>
        <div class="toggle-group" id="edit-status-group">
          <button type="button" class="toggle-btn status-btn active" data-status="green">ğŸŸ¢</button>
          <button type="button" class="toggle-btn status-btn" data-status="yellow">ğŸŸ¡</button>
          <button type="button" class="toggle-btn status-btn" data-status="red">ğŸ”´</button>
        </div>
      </div>
      <fieldset id="edit-mother-fields">
        <legend>Mother Options</legend>
        <div class="form-row">
          <label>G / P</label>
          <div style="display:flex;gap:0.4rem;">
            <input type="text" id="edit-gravida" placeholder="G" maxlength="5" style="width:50%;" autocomplete="off">
            <input type="text" id="edit-para" placeholder="P" maxlength="10" style="width:50%;" autocomplete="off">
          </div>
        </div>
        <div class="form-row">
          <label>GA (weeks)</label>
          <input type="text" id="edit-ga" placeholder="e.g. 38+2" maxlength="10" autocomplete="off">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-preeclamptic"> Preeclamptic (2hr mag checks)</label>
        </div>
        <div class="form-row" id="edit-mag-start-row" style="display:none">
          <label>Mag Start Time</label>
          <input type="datetime-local" id="edit-mag-start">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-labor"> In Labor (4hr progress notes)</label>
        </div>
        <div class="form-row" id="edit-labor-start-row" style="display:none">
          <label>Labor Note Start Time</label>
          <input type="datetime-local" id="edit-labor-start">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-csection"> C-Section</label>
        </div>
        <div class="form-row" id="edit-csection-date-row" style="display:none">
          <label>C-Section Date</label>
          <input type="date" id="edit-csection-date">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-delivered"> Delivered</label>
        </div>
        <div class="form-row" id="edit-delivery-date-row" style="display:none">
          <label>Delivery Date/Time</label>
          <input type="datetime-local" id="edit-delivery-time">
        </div>
        <div class="form-row">
          <label>EBL (mL)</label>
          <input type="number" id="edit-ebl" min="0" inputmode="numeric">
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-gbs"> GBS +</label>
        </div>
      </fieldset>
      <fieldset id="edit-baby-fields" style="display:none">
        <legend>Baby Options</legend>
        <div class="form-row">
          <label>Birth Weight (g)</label>
          <input type="number" id="edit-weight" min="0" inputmode="numeric">
        </div>
        <div class="form-row">
          <label>Feeding</label>
          <select id="edit-feeding">
            <option value="">â€”</option>
            <option value="breast">Breast</option>
            <option value="bottle">Bottle</option>
            <option value="combo">Combo</option>
          </select>
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-nicu"> In NICU</label>
        </div>
        <div class="form-row checkbox-row">
          <label><input type="checkbox" id="edit-bili-lights"> On Bili Lights</label>
        </div>
        <div class="form-row">
          <label>Bili Level</label>
          <input type="number" id="edit-bili" min="0" step="0.1" inputmode="decimal">
        </div>
      </fieldset>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Save</button>
        <button type="button" id="btn-delete-patient" class="btn-danger">Delete Patient</button>
      </div>
    </form>
  </div>
</div>

<!-- Alerts Modal -->
<div id="modal-alerts" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Manage Alerts</h2>
      <button class="modal-close" data-close="modal-alerts">âœ•</button>
    </div>
    <form id="form-alert">
      <input type="hidden" id="alert-patient-id">
      <div class="form-row">
        <label>Alert Type</label>
        <select id="alert-type">
          <option value="custom">Custom</option>
          <option value="blood_draw">ğŸ©¸ Blood Draw</option>
          <option value="mag_check">ğŸ’Š Mag Check (q2h)</option>
          <option value="labor_note">ğŸ“ Labor Note (q4h)</option>
          <option value="cbc">ğŸ§ª CBC Check</option>
          <option value="glucose">ğŸ¬ Glucose Check</option>
        </select>
      </div>
      <div class="form-row" id="custom-label-row">
        <label>Label</label>
        <input type="text" id="alert-label" maxlength="30" autocomplete="off">
      </div>
      <div class="form-row">
        <label>Start Time</label>
        <input type="datetime-local" id="alert-start">
      </div>
      <div class="form-row">
        <label>Repeat (hours)</label>
        <input type="number" id="alert-repeat" min="0" step="0.5" value="0" inputmode="decimal">
        <small>0 = one-time alert</small>
      </div>
      <button type="submit" class="btn-primary">Add Alert</button>
    </form>
    <div id="alert-list" class="alert-list"></div>
  </div>
</div>

<!-- Export / Import Modal -->
<div id="modal-data" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Export / Import</h2>
      <button class="modal-close" data-close="modal-data">âœ•</button>
    </div>
    <div class="detail-section">
      <h3>Export</h3>
      <p style="font-size:0.8rem;color:var(--fg2);margin-bottom:0.4rem;">Download all patient data as a JSON file, or copy it to your clipboard.</p>
      <div class="detail-actions">
        <button class="btn-secondary" id="btn-export-file">ğŸ’¾ Download File</button>
        <button class="btn-secondary" id="btn-export-copy">ğŸ“‹ Copy to Clipboard</button>
      </div>
    </div>
    <div class="detail-section" style="margin-top:1rem;">
      <h3>Import</h3>
      <p style="font-size:0.8rem;color:var(--fg2);margin-bottom:0.4rem;">Load a previously exported JSON file. You can merge with existing data or replace it entirely.</p>
      <input type="file" id="import-file" accept=".json,application/json" style="margin-bottom:0.5rem;">
      <div class="toggle-group" style="margin-bottom:0.5rem;">
        <button type="button" class="toggle-btn active" id="import-mode-merge" data-import="merge">Merge</button>
        <button type="button" class="toggle-btn" id="import-mode-replace" data-import="replace">Replace</button>
      </div>
      <small style="color:var(--fg2);display:block;margin-bottom:0.5rem;">Merge = add new patients, skip duplicates. Replace = overwrite everything.</small>
      <button class="btn-primary" id="btn-import">Import</button>
      <div id="import-status" style="margin-top:0.4rem;font-size:0.8rem;"></div>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
